<?php

/*
 * Unit test(s) for OS Profiles
 */

class OpenscholarProfilesTestCase extends DrupalTestCase {

  public static function getInfo() {
    return array(
      'name' => 'os_profiles module functionality',
      'description' => 'Tests hooks in the os_profiles module',
      'group' => 'OS Profiles',
    ); 
  }

  public function setUp() {
    $this->setup = TRUE;
  }

  /* 
   * Test validity of synchronization URLs
   *
   * Method must begin with "test"
   **/
  public function testOpenscholarProfilesSyncLinks() {

    // Take a random sample of 10 URLs
    $result = db_select('field_data_field_original_destination_url', 'u')
      ->fields('u')
      ->orderBy('rand()')
      ->range(0, 10) 
      ->execute();

    while ($row = $result->fetchAssoc()) {
      $url = $row['field_original_destination_url_value'];
      $response = drupal_http_request($url);
      $this->assertEqual($response->code, 200, "HTTP response from $url is " . $response->code . ", not 200.");
    }
  }

  public function tearDown() {

  }
}
